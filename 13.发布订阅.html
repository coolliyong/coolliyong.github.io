<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta http-equiv="X-UA-Compatible" content="ie=edge" />
    <title>Document</title>
  </head>
  <body>
    <script>
      class EventEmitter {
        constructor() {
          this.subs = {}
          // 期望的数据结构
          // this.events = {
          //   event: [fn1, fn2],
          // }
        }

        /**
         *
         * 注册事件
         * @param {*} event
         * @param {*} cb
         * @memberof EventEmitter
         */
        on(event, cb) {
          // 注册订阅 事件 和增加回调方法
          ;(this.subs[event] || (this.subs[event] = [])).push(cb)
        }

        /**
         *
         * 发布事件
         * @param {*} event
         * @param {*} args
         * @memberof EventEmitter
         */
        trigger(event, ...args) {
          // 执行 事件中回调方法内的所有 函数
          this.subs[event] && this.subs[event].forEach(cb => cb(...args))
        }

        /**
         *
         * 执行一次
         * @param {*} event
         * @param {*} onceCb
         * @memberof EventEmitter
         */
        once(event, onceCb) {
          const cb = (...args) => {
            onceCb(...args)
            // 执行完移除
            this.off(event, onceCb)
          }
          this.on(event, cb)
        }

        /**
         *
         * 移除注册事件
         * @param {*} event
         * @param {*} offCb
         * @memberof EventEmitter
         */
        off(event, offCb) {
          if (this.subs[event]) {
            let index = this.subs[event].findIndex(cb => cb === offCb)
            this.subs[event].splice(index, 1)
            if (!this.subs[event].length) delete this.subs[event]
          }
        }
      }

      let ev1 = new EventEmitter()

      ev1.on('t', () => {
        console.log('t')
      })

      ev1.trigger('t')
    </script>
  </body>
</html>
